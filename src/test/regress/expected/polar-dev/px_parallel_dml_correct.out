-- config
/*--POLAR_ENABLE_PX*/
set polar_enable_px = 1;
set polar_px_enable_insert_select = 1;
set polar_px_optimizer_enable_dml_constraints = 1;
set polar_px_enable_insert_from_tableless = 1;
-- create table
\i sql/polar-dev/px_parallel_dml_init_corr.sql
-- create normal table
drop table if exists px_parallel_dml_corr_t1 cascade;
psql:sql/polar-dev/px_parallel_dml_init_corr.sql:2: NOTICE:  table "px_parallel_dml_corr_t1" does not exist, skipping
CREATE TABLE px_parallel_dml_corr_t1 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t1 select generate_series(1,100),generate_series(1,100);
drop table if exists px_parallel_dml_corr_t2 cascade;
psql:sql/polar-dev/px_parallel_dml_init_corr.sql:6: NOTICE:  table "px_parallel_dml_corr_t2" does not exist, skipping
CREATE TABLE px_parallel_dml_corr_t2 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t2 select generate_series(1,100),generate_series(1,100);
drop table if exists px_parallel_dml_corr_t3 cascade;
psql:sql/polar-dev/px_parallel_dml_init_corr.sql:10: NOTICE:  table "px_parallel_dml_corr_t3" does not exist, skipping
CREATE TABLE px_parallel_dml_corr_t3 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t3 select generate_series(1,1000),generate_series(1,1000);
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   100
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   100
(1 row)

-- create partition table
drop table if exists px_parallel_dml_corr_t0_hash_insert cascade;
psql:sql/polar-dev/px_parallel_dml_init_corr.sql:19: NOTICE:  table "px_parallel_dml_corr_t0_hash_insert" does not exist, skipping
CREATE TABLE px_parallel_dml_corr_t0_hash_insert (id int, value int) PARTITION BY HASH(id);
drop table if exists px_parallel_dml_corr_t0_insert cascade;
psql:sql/polar-dev/px_parallel_dml_init_corr.sql:21: NOTICE:  table "px_parallel_dml_corr_t0_insert" does not exist, skipping
CREATE TABLE px_parallel_dml_corr_t0_insert (id int, value int);
drop table if exists px_parallel_dml_corr_t0_select_table cascade;
psql:sql/polar-dev/px_parallel_dml_init_corr.sql:23: NOTICE:  table "px_parallel_dml_corr_t0_select_table" does not exist, skipping
CREATE TABLE px_parallel_dml_corr_t0_select_table (id int, value int);
insert into px_parallel_dml_corr_t0_select_table select generate_series(1,12000),generate_series(1,12000);
drop table if exists px_parallel_dml_corr_t0_select_list_table cascade;
psql:sql/polar-dev/px_parallel_dml_init_corr.sql:26: NOTICE:  table "px_parallel_dml_corr_t0_select_list_table" does not exist, skipping
CREATE TABLE px_parallel_dml_corr_t0_select_list_table (status character varying(30), value int);
-- PX Insert... Select from Partition Table
------------------------------------------------------------------------
-- Create partition table
drop table if exists px_parallel_dml_corr_t0_hash cascade;
psql:sql/polar-dev/px_parallel_dml_init_corr.sql:33: NOTICE:  table "px_parallel_dml_corr_t0_hash" does not exist, skipping
CREATE TABLE px_parallel_dml_corr_t0_hash (id int, value int) PARTITION BY HASH(id);
CREATE TABLE px_parallel_dml_corr_t0_hash_p1 PARTITION OF px_parallel_dml_corr_t0_hash FOR VALUES WITH (modulus 3, remainder 0);
CREATE TABLE px_parallel_dml_corr_t0_hash_p2 PARTITION OF px_parallel_dml_corr_t0_hash FOR VALUES WITH (modulus 3, remainder 1);
CREATE TABLE px_parallel_dml_corr_t0_hash_p3 PARTITION OF px_parallel_dml_corr_t0_hash FOR VALUES WITH (modulus 3, remainder 2);
insert into px_parallel_dml_corr_t0_hash select generate_series(1,30000),generate_series(1,30000);
------------------------------------------------------------------------
--range partition
--Partition constraint: ((x IS NOT NULL) AND (x >= 10) AND (x < 20))
drop table if exists px_parallel_dml_corr_t1_range cascade;
psql:sql/polar-dev/px_parallel_dml_init_corr.sql:43: NOTICE:  table "px_parallel_dml_corr_t1_range" does not exist, skipping
CREATE TABLE px_parallel_dml_corr_t1_range(id int, value int) PARTITION BY RANGE(id);
CREATE TABLE px_parallel_dml_corr_t1_range_p1 PARTITION OF px_parallel_dml_corr_t1_range FOR VALUES FROM (1) TO (10000);
CREATE TABLE px_parallel_dml_corr_t1_range_p2 PARTITION OF px_parallel_dml_corr_t1_range FOR VALUES FROM (10000) TO (20000);
CREATE TABLE px_parallel_dml_corr_t1_range_p3 PARTITION OF px_parallel_dml_corr_t1_range DEFAULT;
insert into px_parallel_dml_corr_t1_range select generate_series(1,30000, 2);
--range partition with INDEX
drop table if exists px_parallel_dml_corr_t1_range_index cascade;
psql:sql/polar-dev/px_parallel_dml_init_corr.sql:51: NOTICE:  table "px_parallel_dml_corr_t1_range_index" does not exist, skipping
CREATE TABLE px_parallel_dml_corr_t1_range_index(id int, value int) PARTITION BY RANGE(id);
CREATE TABLE px_parallel_dml_corr_t1_range_p1_index PARTITION OF px_parallel_dml_corr_t1_range_index FOR VALUES FROM (1) TO (10000);
CREATE TABLE px_parallel_dml_corr_t1_range_p2_index PARTITION OF px_parallel_dml_corr_t1_range_index FOR VALUES FROM (10000) TO (20000);
CREATE TABLE px_parallel_dml_corr_t1_range_p3_index PARTITION OF px_parallel_dml_corr_t1_range_index DEFAULT;
insert into px_parallel_dml_corr_t1_range_index select generate_series(1,30000, 2);
CREATE INDEX px_parallel_dml_corr_t1_partition_index on px_parallel_dml_corr_t1_range_index(id);
------------------------------------------------------------------------
--list
--Partition constraint: ((b IS NOT NULL) AND (b = ANY (ARRAY[1, 3])))
drop table if exists px_parallel_dml_corr_t2_list cascade;
psql:sql/polar-dev/px_parallel_dml_init_corr.sql:64: NOTICE:  table "px_parallel_dml_corr_t2_list" does not exist, skipping
create table px_parallel_dml_corr_t2_list(job character varying(30), pvalue int) partition by list (job);
CREATE TABLE px_parallel_dml_corr_t2_list_p1 PARTITION OF px_parallel_dml_corr_t2_list FOR VALUES IN ('student');
CREATE TABLE px_parallel_dml_corr_t2_list_p2 PARTITION OF px_parallel_dml_corr_t2_list FOR VALUES IN ('teacher');
CREATE TABLE px_parallel_dml_corr_t2_list_p3 PARTITION OF px_parallel_dml_corr_t2_list DEFAULT;
insert into px_parallel_dml_corr_t2_list select 'student',generate_series(1,10000);
insert into px_parallel_dml_corr_t2_list select 'teacher',generate_series(10000,20000);
insert into px_parallel_dml_corr_t2_list select 'other',generate_series(20000,30000);
-- Index Test Init
drop table if exists px_parallel_dml_corr_t4 cascade;
psql:sql/polar-dev/px_parallel_dml_init_corr.sql:74: NOTICE:  table "px_parallel_dml_corr_t4" does not exist, skipping
CREATE TABLE px_parallel_dml_corr_t4 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t4 select generate_series(1,1000),generate_series(1,1000);
CREATE INDEX t_index_corr on px_parallel_dml_corr_t4(c1);
-- Constrain Test Init
drop table if exists px_parallel_dml_corr_t5 cascade;
psql:sql/polar-dev/px_parallel_dml_init_corr.sql:81: NOTICE:  table "px_parallel_dml_corr_t5" does not exist, skipping
CREATE TABLE px_parallel_dml_corr_t5 (c1 int, c2 int not NULL) ;
drop table if exists px_parallel_dml_corr_t6 cascade;
psql:sql/polar-dev/px_parallel_dml_init_corr.sql:83: NOTICE:  table "px_parallel_dml_corr_t6" does not exist, skipping
CREATE TABLE px_parallel_dml_corr_t6 (c1 int, c2 int) ;
---- Insert into table with default num
drop table if exists px_parallel_dml_corr_t8 cascade;
psql:sql/polar-dev/px_parallel_dml_init_corr.sql:88: NOTICE:  table "px_parallel_dml_corr_t8" does not exist, skipping
CREATE TABLE px_parallel_dml_corr_t8(
c1 int,
c2 int DEFAULT 99999,
c3 varchar DEFAULT NULL,
c4 timestamp default '2016-06-22 19:10:25-07'
);
drop table if exists px_parallel_dml_corr_t9 cascade;
psql:sql/polar-dev/px_parallel_dml_init_corr.sql:96: NOTICE:  table "px_parallel_dml_corr_t9" does not exist, skipping
CREATE TABLE px_parallel_dml_corr_t9 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t9 select generate_series(1,20),generate_series(1,20);
-- Slow SQL, Only once
-- Delete
delete from px_parallel_dml_corr_t2 as px_parallel_dml_corr_t0 where px_parallel_dml_corr_t0.c1 < (select c2 from px_parallel_dml_corr_t1 order by c2 LIMIT 1);
delete from px_parallel_dml_corr_t1 as px_parallel_dml_corr_t0 where px_parallel_dml_corr_t0.c1 < (select c2 from px_parallel_dml_corr_t2 order by c2 LIMIT 1);
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   100
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   100
(1 row)

-- Update
update px_parallel_dml_corr_t2 set c1 = px_parallel_dml_corr_t1.c2 from px_parallel_dml_corr_t1;
update px_parallel_dml_corr_t1 set c1 = px_parallel_dml_corr_t2.c2 from px_parallel_dml_corr_t2;
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   100
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   100
(1 row)

update px_parallel_dml_corr_t2 set c2 = px_parallel_dml_corr_t1.c2 from px_parallel_dml_corr_t1;
update px_parallel_dml_corr_t1 set c2 = px_parallel_dml_corr_t2.c2 from px_parallel_dml_corr_t2;
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   100
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   100
(1 row)

-- One Writer worker
set polar_px_insert_dop_num = 1;
\i sql/polar-dev/px_parallel_dml_init_corr.sql
-- create normal table
drop table if exists px_parallel_dml_corr_t1 cascade;
CREATE TABLE px_parallel_dml_corr_t1 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t1 select generate_series(1,100),generate_series(1,100);
drop table if exists px_parallel_dml_corr_t2 cascade;
CREATE TABLE px_parallel_dml_corr_t2 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t2 select generate_series(1,100),generate_series(1,100);
drop table if exists px_parallel_dml_corr_t3 cascade;
CREATE TABLE px_parallel_dml_corr_t3 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t3 select generate_series(1,1000),generate_series(1,1000);
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   100
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   100
(1 row)

-- create partition table
drop table if exists px_parallel_dml_corr_t0_hash_insert cascade;
CREATE TABLE px_parallel_dml_corr_t0_hash_insert (id int, value int) PARTITION BY HASH(id);
drop table if exists px_parallel_dml_corr_t0_insert cascade;
CREATE TABLE px_parallel_dml_corr_t0_insert (id int, value int);
drop table if exists px_parallel_dml_corr_t0_select_table cascade;
CREATE TABLE px_parallel_dml_corr_t0_select_table (id int, value int);
insert into px_parallel_dml_corr_t0_select_table select generate_series(1,12000),generate_series(1,12000);
drop table if exists px_parallel_dml_corr_t0_select_list_table cascade;
CREATE TABLE px_parallel_dml_corr_t0_select_list_table (status character varying(30), value int);
-- PX Insert... Select from Partition Table
------------------------------------------------------------------------
-- Create partition table
drop table if exists px_parallel_dml_corr_t0_hash cascade;
CREATE TABLE px_parallel_dml_corr_t0_hash (id int, value int) PARTITION BY HASH(id);
CREATE TABLE px_parallel_dml_corr_t0_hash_p1 PARTITION OF px_parallel_dml_corr_t0_hash FOR VALUES WITH (modulus 3, remainder 0);
CREATE TABLE px_parallel_dml_corr_t0_hash_p2 PARTITION OF px_parallel_dml_corr_t0_hash FOR VALUES WITH (modulus 3, remainder 1);
CREATE TABLE px_parallel_dml_corr_t0_hash_p3 PARTITION OF px_parallel_dml_corr_t0_hash FOR VALUES WITH (modulus 3, remainder 2);
insert into px_parallel_dml_corr_t0_hash select generate_series(1,30000),generate_series(1,30000);
------------------------------------------------------------------------
--range partition
--Partition constraint: ((x IS NOT NULL) AND (x >= 10) AND (x < 20))
drop table if exists px_parallel_dml_corr_t1_range cascade;
CREATE TABLE px_parallel_dml_corr_t1_range(id int, value int) PARTITION BY RANGE(id);
CREATE TABLE px_parallel_dml_corr_t1_range_p1 PARTITION OF px_parallel_dml_corr_t1_range FOR VALUES FROM (1) TO (10000);
CREATE TABLE px_parallel_dml_corr_t1_range_p2 PARTITION OF px_parallel_dml_corr_t1_range FOR VALUES FROM (10000) TO (20000);
CREATE TABLE px_parallel_dml_corr_t1_range_p3 PARTITION OF px_parallel_dml_corr_t1_range DEFAULT;
insert into px_parallel_dml_corr_t1_range select generate_series(1,30000, 2);
--range partition with INDEX
drop table if exists px_parallel_dml_corr_t1_range_index cascade;
CREATE TABLE px_parallel_dml_corr_t1_range_index(id int, value int) PARTITION BY RANGE(id);
CREATE TABLE px_parallel_dml_corr_t1_range_p1_index PARTITION OF px_parallel_dml_corr_t1_range_index FOR VALUES FROM (1) TO (10000);
CREATE TABLE px_parallel_dml_corr_t1_range_p2_index PARTITION OF px_parallel_dml_corr_t1_range_index FOR VALUES FROM (10000) TO (20000);
CREATE TABLE px_parallel_dml_corr_t1_range_p3_index PARTITION OF px_parallel_dml_corr_t1_range_index DEFAULT;
insert into px_parallel_dml_corr_t1_range_index select generate_series(1,30000, 2);
CREATE INDEX px_parallel_dml_corr_t1_partition_index on px_parallel_dml_corr_t1_range_index(id);
------------------------------------------------------------------------
--list
--Partition constraint: ((b IS NOT NULL) AND (b = ANY (ARRAY[1, 3])))
drop table if exists px_parallel_dml_corr_t2_list cascade;
create table px_parallel_dml_corr_t2_list(job character varying(30), pvalue int) partition by list (job);
CREATE TABLE px_parallel_dml_corr_t2_list_p1 PARTITION OF px_parallel_dml_corr_t2_list FOR VALUES IN ('student');
CREATE TABLE px_parallel_dml_corr_t2_list_p2 PARTITION OF px_parallel_dml_corr_t2_list FOR VALUES IN ('teacher');
CREATE TABLE px_parallel_dml_corr_t2_list_p3 PARTITION OF px_parallel_dml_corr_t2_list DEFAULT;
insert into px_parallel_dml_corr_t2_list select 'student',generate_series(1,10000);
insert into px_parallel_dml_corr_t2_list select 'teacher',generate_series(10000,20000);
insert into px_parallel_dml_corr_t2_list select 'other',generate_series(20000,30000);
-- Index Test Init
drop table if exists px_parallel_dml_corr_t4 cascade;
CREATE TABLE px_parallel_dml_corr_t4 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t4 select generate_series(1,1000),generate_series(1,1000);
CREATE INDEX t_index_corr on px_parallel_dml_corr_t4(c1);
-- Constrain Test Init
drop table if exists px_parallel_dml_corr_t5 cascade;
CREATE TABLE px_parallel_dml_corr_t5 (c1 int, c2 int not NULL) ;
drop table if exists px_parallel_dml_corr_t6 cascade;
CREATE TABLE px_parallel_dml_corr_t6 (c1 int, c2 int) ;
---- Insert into table with default num
drop table if exists px_parallel_dml_corr_t8 cascade;
CREATE TABLE px_parallel_dml_corr_t8(
c1 int,
c2 int DEFAULT 99999,
c3 varchar DEFAULT NULL,
c4 timestamp default '2016-06-22 19:10:25-07'
);
drop table if exists px_parallel_dml_corr_t9 cascade;
CREATE TABLE px_parallel_dml_corr_t9 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t9 select generate_series(1,20),generate_series(1,20);
\i sql/polar-dev/px_parallel_dml_base_corr.sql
-- Insert
insert into px_parallel_dml_corr_t1 select generate_series(1,60),generate_series(1,60);
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   160
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   100
(1 row)

insert into px_parallel_dml_corr_t1 select c2, c1 from px_parallel_dml_corr_t1;
insert into px_parallel_dml_corr_t2 select c2, c1 from px_parallel_dml_corr_t1;
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   320
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   420
(1 row)

insert into px_parallel_dml_corr_t1 select c2, c1 from px_parallel_dml_corr_t2 where c1 = '1';
insert into px_parallel_dml_corr_t2 select c2, c1 from px_parallel_dml_corr_t1 where c1 = '1';
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   325
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   429
(1 row)

-- Not Use PX Insert
insert into px_parallel_dml_corr_t1 VALUES(100,100);
insert into px_parallel_dml_corr_t2 VALUES(200,200);
insert into px_parallel_dml_corr_t1 select generate_series(101,150),generate_series(101,150);
insert into px_parallel_dml_corr_t2 select generate_series(101,150),generate_series(101,150);
insert into px_parallel_dml_corr_t1 select 1,2;
insert into px_parallel_dml_corr_t2 select 3,4;
insert into px_parallel_dml_corr_t1 select generate_series(201,250), c2 from px_parallel_dml_corr_t2;
insert into px_parallel_dml_corr_t1 select generate_series(301,350),generate_series(301,350) union select * from px_parallel_dml_corr_t3;
-- Use PX Insert
insert into px_parallel_dml_corr_t1 select * from px_parallel_dml_corr_t2;
--Insert into normal table select * from partition table
insert into px_parallel_dml_corr_t0_insert select px_parallel_dml_corr_t0_hash.id,px_parallel_dml_corr_t1_range.value from px_parallel_dml_corr_t0_hash,px_parallel_dml_corr_t1_range where px_parallel_dml_corr_t0_hash.id = px_parallel_dml_corr_t1_range.id and px_parallel_dml_corr_t1_range.id < 2000;
insert into px_parallel_dml_corr_t0_insert select * from px_parallel_dml_corr_t0_hash where id < 2000;
insert into px_parallel_dml_corr_t0_insert select px_parallel_dml_corr_t0_hash.id,px_parallel_dml_corr_t1_range.value from px_parallel_dml_corr_t0_hash,px_parallel_dml_corr_t1_range where px_parallel_dml_corr_t0_hash.id = px_parallel_dml_corr_t1_range.id and px_parallel_dml_corr_t1_range.id > 28000;
insert into px_parallel_dml_corr_t0_insert select px_parallel_dml_corr_t0_hash.id,px_parallel_dml_corr_t1_range.value from px_parallel_dml_corr_t0_hash,px_parallel_dml_corr_t1_range where px_parallel_dml_corr_t0_hash.id = px_parallel_dml_corr_t1_range.id and px_parallel_dml_corr_t1_range.id > 28000;
insert into px_parallel_dml_corr_t0_insert select * from  px_parallel_dml_corr_t1_range where id > 29000;
insert into px_parallel_dml_corr_t0_insert select * from px_parallel_dml_corr_t2_list where job='student';
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:37: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t0_insert select * from px_...
                                                          ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t0_insert select 100000,pvalue from px_parallel_dml_corr_t2_list where job='student';
insert into px_parallel_dml_corr_t0_insert select id, px_parallel_dml_corr_t2_list.pvalue from px_parallel_dml_corr_t2_list,px_parallel_dml_corr_t0_hash where px_parallel_dml_corr_t2_list.job='student' and px_parallel_dml_corr_t0_hash.id < 5000 LIMIT 5000;
select count(*)from px_parallel_dml_corr_t0_insert;
 count 
-------
 20499
(1 row)

-- Open the px_enable_insert_partition_table
set polar_px_enable_insert_partition_table='on';
--Insert into partition table select * from normal table
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
-- With Index
insert into px_parallel_dml_corr_t1_range_index select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t2_list select 'student',px_parallel_dml_corr_t0_select_table.id from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id LIMIT 1000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
select count(*) from px_parallel_dml_corr_t0_hash;
 count 
-------
 31000
(1 row)

select count(*) from px_parallel_dml_corr_t1_range;
 count 
-------
 16000
(1 row)

select count(*) from px_parallel_dml_corr_t2_list;
 count 
-------
 32002
(1 row)

--Insert into partition table select * from partition table
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t1_range where id < 2000;
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:60: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t0_hash select * from px_pa...
                                                        ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t0_hash select 100000,pvalue from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:64: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t1_range select * from px_p...
                                                         ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t1_range select 100000,pvalue from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
insert into px_parallel_dml_corr_t2_list select 'student',px_parallel_dml_corr_t0_hash.id from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t1_range where id < 2000;
select count(*) from px_parallel_dml_corr_t0_hash;
 count 
-------
 33000
(1 row)

select count(*) from px_parallel_dml_corr_t1_range;
 count 
-------
 18000
(1 row)

select count(*) from px_parallel_dml_corr_t2_list;
 count 
-------
 38002
(1 row)

-- Close the px_enable_insert_partition_table
set polar_px_enable_insert_partition_table='off';
--Insert into partition table select * from normal table
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
-- With Index
insert into px_parallel_dml_corr_t1_range_index select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t2_list select 'student',px_parallel_dml_corr_t0_select_table.id from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
select count(*) from px_parallel_dml_corr_t0_hash;
 count 
-------
 34000
(1 row)

select count(*) from px_parallel_dml_corr_t1_range;
 count 
-------
 19000
(1 row)

select count(*) from px_parallel_dml_corr_t2_list;
 count 
-------
 40002
(1 row)

--Insert into partition table select * from partition table
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t1_range where id < 2000;
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:92: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t0_hash select * from px_pa...
                                                        ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t0_hash select 100000,pvalue from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:96: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t1_range select * from px_p...
                                                         ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t1_range select 100000,pvalue from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
insert into px_parallel_dml_corr_t2_list select * from 'student',px_parallel_dml_corr_t0_hash.id where id > 28000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:99: ERROR:  syntax error at or near "'student'"
LINE 1: ...t into px_parallel_dml_corr_t2_list select * from 'student',...
                                                             ^
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t1_range where id < 2000;
select count(*) from px_parallel_dml_corr_t0_hash;
 count 
-------
 37000
(1 row)

select count(*) from px_parallel_dml_corr_t1_range;
 count 
-------
 21000
(1 row)

select count(*) from px_parallel_dml_corr_t2_list;
 count 
-------
 45002
(1 row)

------------------------------------------------------------------------
--Insert into ... select from index
insert into px_parallel_dml_corr_t3 select * from px_parallel_dml_corr_t4 where c1 < 500;
insert into px_parallel_dml_corr_t3 select * from px_parallel_dml_corr_t4 where c2 < 500;
select count(*) from px_parallel_dml_corr_t3;
 count 
-------
  1998
(1 row)

------------------------------------------------------------------------
-- Select Join
-- Innser join
insert into px_parallel_dml_corr_t1 select c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 LEFT OUTER JOIN px_parallel_dml_corr_t3 using(c1);
insert into px_parallel_dml_corr_t1 select c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 RIGHT OUTER JOIN px_parallel_dml_corr_t3 using(c1);
insert into px_parallel_dml_corr_t1 select c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 FULL OUTER JOIN px_parallel_dml_corr_t3 using(c1);
insert into px_parallel_dml_corr_t1 select px_parallel_dml_corr_t2.c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 CROSS JOIN px_parallel_dml_corr_t3 LIMIT 5000;
insert into px_parallel_dml_corr_t1 select c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 NATURAL JOIN px_parallel_dml_corr_t3;
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
 39767
(1 row)

------------------------------------------------------------------------
-- Group BY
insert into px_parallel_dml_corr_t1 select * from px_parallel_dml_corr_t2 group by c1,c2;
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
 39919
(1 row)

----------------------------------------------------------------------------
---- Insert into table with default num
insert into px_parallel_dml_corr_t8 select c1 from px_parallel_dml_corr_t9;
select * from px_parallel_dml_corr_t8 ORDER BY c1 ASC;
 c1 |  c2   | c3 |            c4            
----+-------+----+--------------------------
  1 | 99999 |    | Wed Jun 22 19:10:25 2016
  2 | 99999 |    | Wed Jun 22 19:10:25 2016
  3 | 99999 |    | Wed Jun 22 19:10:25 2016
  4 | 99999 |    | Wed Jun 22 19:10:25 2016
  5 | 99999 |    | Wed Jun 22 19:10:25 2016
  6 | 99999 |    | Wed Jun 22 19:10:25 2016
  7 | 99999 |    | Wed Jun 22 19:10:25 2016
  8 | 99999 |    | Wed Jun 22 19:10:25 2016
  9 | 99999 |    | Wed Jun 22 19:10:25 2016
 10 | 99999 |    | Wed Jun 22 19:10:25 2016
 11 | 99999 |    | Wed Jun 22 19:10:25 2016
 12 | 99999 |    | Wed Jun 22 19:10:25 2016
 13 | 99999 |    | Wed Jun 22 19:10:25 2016
 14 | 99999 |    | Wed Jun 22 19:10:25 2016
 15 | 99999 |    | Wed Jun 22 19:10:25 2016
 16 | 99999 |    | Wed Jun 22 19:10:25 2016
 17 | 99999 |    | Wed Jun 22 19:10:25 2016
 18 | 99999 |    | Wed Jun 22 19:10:25 2016
 19 | 99999 |    | Wed Jun 22 19:10:25 2016
 20 | 99999 |    | Wed Jun 22 19:10:25 2016
(20 rows)

-- Writer workers < Reader workers
set polar_px_insert_dop_num = 3;
\i sql/polar-dev/px_parallel_dml_init_corr.sql
-- create normal table
drop table if exists px_parallel_dml_corr_t1 cascade;
CREATE TABLE px_parallel_dml_corr_t1 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t1 select generate_series(1,100),generate_series(1,100);
drop table if exists px_parallel_dml_corr_t2 cascade;
CREATE TABLE px_parallel_dml_corr_t2 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t2 select generate_series(1,100),generate_series(1,100);
drop table if exists px_parallel_dml_corr_t3 cascade;
CREATE TABLE px_parallel_dml_corr_t3 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t3 select generate_series(1,1000),generate_series(1,1000);
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   100
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   100
(1 row)

-- create partition table
drop table if exists px_parallel_dml_corr_t0_hash_insert cascade;
CREATE TABLE px_parallel_dml_corr_t0_hash_insert (id int, value int) PARTITION BY HASH(id);
drop table if exists px_parallel_dml_corr_t0_insert cascade;
CREATE TABLE px_parallel_dml_corr_t0_insert (id int, value int);
drop table if exists px_parallel_dml_corr_t0_select_table cascade;
CREATE TABLE px_parallel_dml_corr_t0_select_table (id int, value int);
insert into px_parallel_dml_corr_t0_select_table select generate_series(1,12000),generate_series(1,12000);
drop table if exists px_parallel_dml_corr_t0_select_list_table cascade;
CREATE TABLE px_parallel_dml_corr_t0_select_list_table (status character varying(30), value int);
-- PX Insert... Select from Partition Table
------------------------------------------------------------------------
-- Create partition table
drop table if exists px_parallel_dml_corr_t0_hash cascade;
CREATE TABLE px_parallel_dml_corr_t0_hash (id int, value int) PARTITION BY HASH(id);
CREATE TABLE px_parallel_dml_corr_t0_hash_p1 PARTITION OF px_parallel_dml_corr_t0_hash FOR VALUES WITH (modulus 3, remainder 0);
CREATE TABLE px_parallel_dml_corr_t0_hash_p2 PARTITION OF px_parallel_dml_corr_t0_hash FOR VALUES WITH (modulus 3, remainder 1);
CREATE TABLE px_parallel_dml_corr_t0_hash_p3 PARTITION OF px_parallel_dml_corr_t0_hash FOR VALUES WITH (modulus 3, remainder 2);
insert into px_parallel_dml_corr_t0_hash select generate_series(1,30000),generate_series(1,30000);
------------------------------------------------------------------------
--range partition
--Partition constraint: ((x IS NOT NULL) AND (x >= 10) AND (x < 20))
drop table if exists px_parallel_dml_corr_t1_range cascade;
CREATE TABLE px_parallel_dml_corr_t1_range(id int, value int) PARTITION BY RANGE(id);
CREATE TABLE px_parallel_dml_corr_t1_range_p1 PARTITION OF px_parallel_dml_corr_t1_range FOR VALUES FROM (1) TO (10000);
CREATE TABLE px_parallel_dml_corr_t1_range_p2 PARTITION OF px_parallel_dml_corr_t1_range FOR VALUES FROM (10000) TO (20000);
CREATE TABLE px_parallel_dml_corr_t1_range_p3 PARTITION OF px_parallel_dml_corr_t1_range DEFAULT;
insert into px_parallel_dml_corr_t1_range select generate_series(1,30000, 2);
--range partition with INDEX
drop table if exists px_parallel_dml_corr_t1_range_index cascade;
CREATE TABLE px_parallel_dml_corr_t1_range_index(id int, value int) PARTITION BY RANGE(id);
CREATE TABLE px_parallel_dml_corr_t1_range_p1_index PARTITION OF px_parallel_dml_corr_t1_range_index FOR VALUES FROM (1) TO (10000);
CREATE TABLE px_parallel_dml_corr_t1_range_p2_index PARTITION OF px_parallel_dml_corr_t1_range_index FOR VALUES FROM (10000) TO (20000);
CREATE TABLE px_parallel_dml_corr_t1_range_p3_index PARTITION OF px_parallel_dml_corr_t1_range_index DEFAULT;
insert into px_parallel_dml_corr_t1_range_index select generate_series(1,30000, 2);
CREATE INDEX px_parallel_dml_corr_t1_partition_index on px_parallel_dml_corr_t1_range_index(id);
------------------------------------------------------------------------
--list
--Partition constraint: ((b IS NOT NULL) AND (b = ANY (ARRAY[1, 3])))
drop table if exists px_parallel_dml_corr_t2_list cascade;
create table px_parallel_dml_corr_t2_list(job character varying(30), pvalue int) partition by list (job);
CREATE TABLE px_parallel_dml_corr_t2_list_p1 PARTITION OF px_parallel_dml_corr_t2_list FOR VALUES IN ('student');
CREATE TABLE px_parallel_dml_corr_t2_list_p2 PARTITION OF px_parallel_dml_corr_t2_list FOR VALUES IN ('teacher');
CREATE TABLE px_parallel_dml_corr_t2_list_p3 PARTITION OF px_parallel_dml_corr_t2_list DEFAULT;
insert into px_parallel_dml_corr_t2_list select 'student',generate_series(1,10000);
insert into px_parallel_dml_corr_t2_list select 'teacher',generate_series(10000,20000);
insert into px_parallel_dml_corr_t2_list select 'other',generate_series(20000,30000);
-- Index Test Init
drop table if exists px_parallel_dml_corr_t4 cascade;
CREATE TABLE px_parallel_dml_corr_t4 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t4 select generate_series(1,1000),generate_series(1,1000);
CREATE INDEX t_index_corr on px_parallel_dml_corr_t4(c1);
-- Constrain Test Init
drop table if exists px_parallel_dml_corr_t5 cascade;
CREATE TABLE px_parallel_dml_corr_t5 (c1 int, c2 int not NULL) ;
drop table if exists px_parallel_dml_corr_t6 cascade;
CREATE TABLE px_parallel_dml_corr_t6 (c1 int, c2 int) ;
---- Insert into table with default num
drop table if exists px_parallel_dml_corr_t8 cascade;
CREATE TABLE px_parallel_dml_corr_t8(
c1 int,
c2 int DEFAULT 99999,
c3 varchar DEFAULT NULL,
c4 timestamp default '2016-06-22 19:10:25-07'
);
drop table if exists px_parallel_dml_corr_t9 cascade;
CREATE TABLE px_parallel_dml_corr_t9 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t9 select generate_series(1,20),generate_series(1,20);
\i sql/polar-dev/px_parallel_dml_base_corr.sql
-- Insert
insert into px_parallel_dml_corr_t1 select generate_series(1,60),generate_series(1,60);
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   160
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   100
(1 row)

insert into px_parallel_dml_corr_t1 select c2, c1 from px_parallel_dml_corr_t1;
insert into px_parallel_dml_corr_t2 select c2, c1 from px_parallel_dml_corr_t1;
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   320
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   420
(1 row)

insert into px_parallel_dml_corr_t1 select c2, c1 from px_parallel_dml_corr_t2 where c1 = '1';
insert into px_parallel_dml_corr_t2 select c2, c1 from px_parallel_dml_corr_t1 where c1 = '1';
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   325
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   429
(1 row)

-- Not Use PX Insert
insert into px_parallel_dml_corr_t1 VALUES(100,100);
insert into px_parallel_dml_corr_t2 VALUES(200,200);
insert into px_parallel_dml_corr_t1 select generate_series(101,150),generate_series(101,150);
insert into px_parallel_dml_corr_t2 select generate_series(101,150),generate_series(101,150);
insert into px_parallel_dml_corr_t1 select 1,2;
insert into px_parallel_dml_corr_t2 select 3,4;
insert into px_parallel_dml_corr_t1 select generate_series(201,250), c2 from px_parallel_dml_corr_t2;
insert into px_parallel_dml_corr_t1 select generate_series(301,350),generate_series(301,350) union select * from px_parallel_dml_corr_t3;
-- Use PX Insert
insert into px_parallel_dml_corr_t1 select * from px_parallel_dml_corr_t2;
--Insert into normal table select * from partition table
insert into px_parallel_dml_corr_t0_insert select px_parallel_dml_corr_t0_hash.id,px_parallel_dml_corr_t1_range.value from px_parallel_dml_corr_t0_hash,px_parallel_dml_corr_t1_range where px_parallel_dml_corr_t0_hash.id = px_parallel_dml_corr_t1_range.id and px_parallel_dml_corr_t1_range.id < 2000;
insert into px_parallel_dml_corr_t0_insert select * from px_parallel_dml_corr_t0_hash where id < 2000;
insert into px_parallel_dml_corr_t0_insert select px_parallel_dml_corr_t0_hash.id,px_parallel_dml_corr_t1_range.value from px_parallel_dml_corr_t0_hash,px_parallel_dml_corr_t1_range where px_parallel_dml_corr_t0_hash.id = px_parallel_dml_corr_t1_range.id and px_parallel_dml_corr_t1_range.id > 28000;
insert into px_parallel_dml_corr_t0_insert select px_parallel_dml_corr_t0_hash.id,px_parallel_dml_corr_t1_range.value from px_parallel_dml_corr_t0_hash,px_parallel_dml_corr_t1_range where px_parallel_dml_corr_t0_hash.id = px_parallel_dml_corr_t1_range.id and px_parallel_dml_corr_t1_range.id > 28000;
insert into px_parallel_dml_corr_t0_insert select * from  px_parallel_dml_corr_t1_range where id > 29000;
insert into px_parallel_dml_corr_t0_insert select * from px_parallel_dml_corr_t2_list where job='student';
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:37: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t0_insert select * from px_...
                                                          ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t0_insert select 100000,pvalue from px_parallel_dml_corr_t2_list where job='student';
insert into px_parallel_dml_corr_t0_insert select id, px_parallel_dml_corr_t2_list.pvalue from px_parallel_dml_corr_t2_list,px_parallel_dml_corr_t0_hash where px_parallel_dml_corr_t2_list.job='student' and px_parallel_dml_corr_t0_hash.id < 5000 LIMIT 5000;
select count(*)from px_parallel_dml_corr_t0_insert;
 count 
-------
 20499
(1 row)

-- Open the px_enable_insert_partition_table
set polar_px_enable_insert_partition_table='on';
--Insert into partition table select * from normal table
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
-- With Index
insert into px_parallel_dml_corr_t1_range_index select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t2_list select 'student',px_parallel_dml_corr_t0_select_table.id from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id LIMIT 1000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
select count(*) from px_parallel_dml_corr_t0_hash;
 count 
-------
 31000
(1 row)

select count(*) from px_parallel_dml_corr_t1_range;
 count 
-------
 16000
(1 row)

select count(*) from px_parallel_dml_corr_t2_list;
 count 
-------
 32002
(1 row)

--Insert into partition table select * from partition table
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t1_range where id < 2000;
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:60: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t0_hash select * from px_pa...
                                                        ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t0_hash select 100000,pvalue from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:64: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t1_range select * from px_p...
                                                         ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t1_range select 100000,pvalue from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
insert into px_parallel_dml_corr_t2_list select 'student',px_parallel_dml_corr_t0_hash.id from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t1_range where id < 2000;
select count(*) from px_parallel_dml_corr_t0_hash;
 count 
-------
 33000
(1 row)

select count(*) from px_parallel_dml_corr_t1_range;
 count 
-------
 18000
(1 row)

select count(*) from px_parallel_dml_corr_t2_list;
 count 
-------
 38002
(1 row)

-- Close the px_enable_insert_partition_table
set polar_px_enable_insert_partition_table='off';
--Insert into partition table select * from normal table
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
-- With Index
insert into px_parallel_dml_corr_t1_range_index select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t2_list select 'student',px_parallel_dml_corr_t0_select_table.id from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
select count(*) from px_parallel_dml_corr_t0_hash;
 count 
-------
 34000
(1 row)

select count(*) from px_parallel_dml_corr_t1_range;
 count 
-------
 19000
(1 row)

select count(*) from px_parallel_dml_corr_t2_list;
 count 
-------
 40002
(1 row)

--Insert into partition table select * from partition table
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t1_range where id < 2000;
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:92: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t0_hash select * from px_pa...
                                                        ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t0_hash select 100000,pvalue from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:96: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t1_range select * from px_p...
                                                         ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t1_range select 100000,pvalue from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
insert into px_parallel_dml_corr_t2_list select * from 'student',px_parallel_dml_corr_t0_hash.id where id > 28000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:99: ERROR:  syntax error at or near "'student'"
LINE 1: ...t into px_parallel_dml_corr_t2_list select * from 'student',...
                                                             ^
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t1_range where id < 2000;
select count(*) from px_parallel_dml_corr_t0_hash;
 count 
-------
 37000
(1 row)

select count(*) from px_parallel_dml_corr_t1_range;
 count 
-------
 21000
(1 row)

select count(*) from px_parallel_dml_corr_t2_list;
 count 
-------
 45002
(1 row)

------------------------------------------------------------------------
--Insert into ... select from index
insert into px_parallel_dml_corr_t3 select * from px_parallel_dml_corr_t4 where c1 < 500;
insert into px_parallel_dml_corr_t3 select * from px_parallel_dml_corr_t4 where c2 < 500;
select count(*) from px_parallel_dml_corr_t3;
 count 
-------
  1998
(1 row)

------------------------------------------------------------------------
-- Select Join
-- Innser join
insert into px_parallel_dml_corr_t1 select c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 LEFT OUTER JOIN px_parallel_dml_corr_t3 using(c1);
insert into px_parallel_dml_corr_t1 select c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 RIGHT OUTER JOIN px_parallel_dml_corr_t3 using(c1);
insert into px_parallel_dml_corr_t1 select c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 FULL OUTER JOIN px_parallel_dml_corr_t3 using(c1);
insert into px_parallel_dml_corr_t1 select px_parallel_dml_corr_t2.c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 CROSS JOIN px_parallel_dml_corr_t3 LIMIT 5000;
insert into px_parallel_dml_corr_t1 select c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 NATURAL JOIN px_parallel_dml_corr_t3;
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
 39767
(1 row)

------------------------------------------------------------------------
-- Group BY
insert into px_parallel_dml_corr_t1 select * from px_parallel_dml_corr_t2 group by c1,c2;
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
 39919
(1 row)

----------------------------------------------------------------------------
---- Insert into table with default num
insert into px_parallel_dml_corr_t8 select c1 from px_parallel_dml_corr_t9;
select * from px_parallel_dml_corr_t8 ORDER BY c1 ASC;
 c1 |  c2   | c3 |            c4            
----+-------+----+--------------------------
  1 | 99999 |    | Wed Jun 22 19:10:25 2016
  2 | 99999 |    | Wed Jun 22 19:10:25 2016
  3 | 99999 |    | Wed Jun 22 19:10:25 2016
  4 | 99999 |    | Wed Jun 22 19:10:25 2016
  5 | 99999 |    | Wed Jun 22 19:10:25 2016
  6 | 99999 |    | Wed Jun 22 19:10:25 2016
  7 | 99999 |    | Wed Jun 22 19:10:25 2016
  8 | 99999 |    | Wed Jun 22 19:10:25 2016
  9 | 99999 |    | Wed Jun 22 19:10:25 2016
 10 | 99999 |    | Wed Jun 22 19:10:25 2016
 11 | 99999 |    | Wed Jun 22 19:10:25 2016
 12 | 99999 |    | Wed Jun 22 19:10:25 2016
 13 | 99999 |    | Wed Jun 22 19:10:25 2016
 14 | 99999 |    | Wed Jun 22 19:10:25 2016
 15 | 99999 |    | Wed Jun 22 19:10:25 2016
 16 | 99999 |    | Wed Jun 22 19:10:25 2016
 17 | 99999 |    | Wed Jun 22 19:10:25 2016
 18 | 99999 |    | Wed Jun 22 19:10:25 2016
 19 | 99999 |    | Wed Jun 22 19:10:25 2016
 20 | 99999 |    | Wed Jun 22 19:10:25 2016
(20 rows)

-- Writer workers == Read workers
set polar_px_insert_dop_num = 6;
\i sql/polar-dev/px_parallel_dml_init_corr.sql
-- create normal table
drop table if exists px_parallel_dml_corr_t1 cascade;
CREATE TABLE px_parallel_dml_corr_t1 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t1 select generate_series(1,100),generate_series(1,100);
drop table if exists px_parallel_dml_corr_t2 cascade;
CREATE TABLE px_parallel_dml_corr_t2 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t2 select generate_series(1,100),generate_series(1,100);
drop table if exists px_parallel_dml_corr_t3 cascade;
CREATE TABLE px_parallel_dml_corr_t3 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t3 select generate_series(1,1000),generate_series(1,1000);
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   100
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   100
(1 row)

-- create partition table
drop table if exists px_parallel_dml_corr_t0_hash_insert cascade;
CREATE TABLE px_parallel_dml_corr_t0_hash_insert (id int, value int) PARTITION BY HASH(id);
drop table if exists px_parallel_dml_corr_t0_insert cascade;
CREATE TABLE px_parallel_dml_corr_t0_insert (id int, value int);
drop table if exists px_parallel_dml_corr_t0_select_table cascade;
CREATE TABLE px_parallel_dml_corr_t0_select_table (id int, value int);
insert into px_parallel_dml_corr_t0_select_table select generate_series(1,12000),generate_series(1,12000);
drop table if exists px_parallel_dml_corr_t0_select_list_table cascade;
CREATE TABLE px_parallel_dml_corr_t0_select_list_table (status character varying(30), value int);
-- PX Insert... Select from Partition Table
------------------------------------------------------------------------
-- Create partition table
drop table if exists px_parallel_dml_corr_t0_hash cascade;
CREATE TABLE px_parallel_dml_corr_t0_hash (id int, value int) PARTITION BY HASH(id);
CREATE TABLE px_parallel_dml_corr_t0_hash_p1 PARTITION OF px_parallel_dml_corr_t0_hash FOR VALUES WITH (modulus 3, remainder 0);
CREATE TABLE px_parallel_dml_corr_t0_hash_p2 PARTITION OF px_parallel_dml_corr_t0_hash FOR VALUES WITH (modulus 3, remainder 1);
CREATE TABLE px_parallel_dml_corr_t0_hash_p3 PARTITION OF px_parallel_dml_corr_t0_hash FOR VALUES WITH (modulus 3, remainder 2);
insert into px_parallel_dml_corr_t0_hash select generate_series(1,30000),generate_series(1,30000);
------------------------------------------------------------------------
--range partition
--Partition constraint: ((x IS NOT NULL) AND (x >= 10) AND (x < 20))
drop table if exists px_parallel_dml_corr_t1_range cascade;
CREATE TABLE px_parallel_dml_corr_t1_range(id int, value int) PARTITION BY RANGE(id);
CREATE TABLE px_parallel_dml_corr_t1_range_p1 PARTITION OF px_parallel_dml_corr_t1_range FOR VALUES FROM (1) TO (10000);
CREATE TABLE px_parallel_dml_corr_t1_range_p2 PARTITION OF px_parallel_dml_corr_t1_range FOR VALUES FROM (10000) TO (20000);
CREATE TABLE px_parallel_dml_corr_t1_range_p3 PARTITION OF px_parallel_dml_corr_t1_range DEFAULT;
insert into px_parallel_dml_corr_t1_range select generate_series(1,30000, 2);
--range partition with INDEX
drop table if exists px_parallel_dml_corr_t1_range_index cascade;
CREATE TABLE px_parallel_dml_corr_t1_range_index(id int, value int) PARTITION BY RANGE(id);
CREATE TABLE px_parallel_dml_corr_t1_range_p1_index PARTITION OF px_parallel_dml_corr_t1_range_index FOR VALUES FROM (1) TO (10000);
CREATE TABLE px_parallel_dml_corr_t1_range_p2_index PARTITION OF px_parallel_dml_corr_t1_range_index FOR VALUES FROM (10000) TO (20000);
CREATE TABLE px_parallel_dml_corr_t1_range_p3_index PARTITION OF px_parallel_dml_corr_t1_range_index DEFAULT;
insert into px_parallel_dml_corr_t1_range_index select generate_series(1,30000, 2);
CREATE INDEX px_parallel_dml_corr_t1_partition_index on px_parallel_dml_corr_t1_range_index(id);
------------------------------------------------------------------------
--list
--Partition constraint: ((b IS NOT NULL) AND (b = ANY (ARRAY[1, 3])))
drop table if exists px_parallel_dml_corr_t2_list cascade;
create table px_parallel_dml_corr_t2_list(job character varying(30), pvalue int) partition by list (job);
CREATE TABLE px_parallel_dml_corr_t2_list_p1 PARTITION OF px_parallel_dml_corr_t2_list FOR VALUES IN ('student');
CREATE TABLE px_parallel_dml_corr_t2_list_p2 PARTITION OF px_parallel_dml_corr_t2_list FOR VALUES IN ('teacher');
CREATE TABLE px_parallel_dml_corr_t2_list_p3 PARTITION OF px_parallel_dml_corr_t2_list DEFAULT;
insert into px_parallel_dml_corr_t2_list select 'student',generate_series(1,10000);
insert into px_parallel_dml_corr_t2_list select 'teacher',generate_series(10000,20000);
insert into px_parallel_dml_corr_t2_list select 'other',generate_series(20000,30000);
-- Index Test Init
drop table if exists px_parallel_dml_corr_t4 cascade;
CREATE TABLE px_parallel_dml_corr_t4 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t4 select generate_series(1,1000),generate_series(1,1000);
CREATE INDEX t_index_corr on px_parallel_dml_corr_t4(c1);
-- Constrain Test Init
drop table if exists px_parallel_dml_corr_t5 cascade;
CREATE TABLE px_parallel_dml_corr_t5 (c1 int, c2 int not NULL) ;
drop table if exists px_parallel_dml_corr_t6 cascade;
CREATE TABLE px_parallel_dml_corr_t6 (c1 int, c2 int) ;
---- Insert into table with default num
drop table if exists px_parallel_dml_corr_t8 cascade;
CREATE TABLE px_parallel_dml_corr_t8(
c1 int,
c2 int DEFAULT 99999,
c3 varchar DEFAULT NULL,
c4 timestamp default '2016-06-22 19:10:25-07'
);
drop table if exists px_parallel_dml_corr_t9 cascade;
CREATE TABLE px_parallel_dml_corr_t9 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t9 select generate_series(1,20),generate_series(1,20);
\i sql/polar-dev/px_parallel_dml_base_corr.sql
-- Insert
insert into px_parallel_dml_corr_t1 select generate_series(1,60),generate_series(1,60);
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   160
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   100
(1 row)

insert into px_parallel_dml_corr_t1 select c2, c1 from px_parallel_dml_corr_t1;
insert into px_parallel_dml_corr_t2 select c2, c1 from px_parallel_dml_corr_t1;
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   320
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   420
(1 row)

insert into px_parallel_dml_corr_t1 select c2, c1 from px_parallel_dml_corr_t2 where c1 = '1';
insert into px_parallel_dml_corr_t2 select c2, c1 from px_parallel_dml_corr_t1 where c1 = '1';
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   325
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   429
(1 row)

-- Not Use PX Insert
insert into px_parallel_dml_corr_t1 VALUES(100,100);
insert into px_parallel_dml_corr_t2 VALUES(200,200);
insert into px_parallel_dml_corr_t1 select generate_series(101,150),generate_series(101,150);
insert into px_parallel_dml_corr_t2 select generate_series(101,150),generate_series(101,150);
insert into px_parallel_dml_corr_t1 select 1,2;
insert into px_parallel_dml_corr_t2 select 3,4;
insert into px_parallel_dml_corr_t1 select generate_series(201,250), c2 from px_parallel_dml_corr_t2;
insert into px_parallel_dml_corr_t1 select generate_series(301,350),generate_series(301,350) union select * from px_parallel_dml_corr_t3;
-- Use PX Insert
insert into px_parallel_dml_corr_t1 select * from px_parallel_dml_corr_t2;
--Insert into normal table select * from partition table
insert into px_parallel_dml_corr_t0_insert select px_parallel_dml_corr_t0_hash.id,px_parallel_dml_corr_t1_range.value from px_parallel_dml_corr_t0_hash,px_parallel_dml_corr_t1_range where px_parallel_dml_corr_t0_hash.id = px_parallel_dml_corr_t1_range.id and px_parallel_dml_corr_t1_range.id < 2000;
insert into px_parallel_dml_corr_t0_insert select * from px_parallel_dml_corr_t0_hash where id < 2000;
insert into px_parallel_dml_corr_t0_insert select px_parallel_dml_corr_t0_hash.id,px_parallel_dml_corr_t1_range.value from px_parallel_dml_corr_t0_hash,px_parallel_dml_corr_t1_range where px_parallel_dml_corr_t0_hash.id = px_parallel_dml_corr_t1_range.id and px_parallel_dml_corr_t1_range.id > 28000;
insert into px_parallel_dml_corr_t0_insert select px_parallel_dml_corr_t0_hash.id,px_parallel_dml_corr_t1_range.value from px_parallel_dml_corr_t0_hash,px_parallel_dml_corr_t1_range where px_parallel_dml_corr_t0_hash.id = px_parallel_dml_corr_t1_range.id and px_parallel_dml_corr_t1_range.id > 28000;
insert into px_parallel_dml_corr_t0_insert select * from  px_parallel_dml_corr_t1_range where id > 29000;
insert into px_parallel_dml_corr_t0_insert select * from px_parallel_dml_corr_t2_list where job='student';
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:37: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t0_insert select * from px_...
                                                          ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t0_insert select 100000,pvalue from px_parallel_dml_corr_t2_list where job='student';
insert into px_parallel_dml_corr_t0_insert select id, px_parallel_dml_corr_t2_list.pvalue from px_parallel_dml_corr_t2_list,px_parallel_dml_corr_t0_hash where px_parallel_dml_corr_t2_list.job='student' and px_parallel_dml_corr_t0_hash.id < 5000 LIMIT 5000;
select count(*)from px_parallel_dml_corr_t0_insert;
 count 
-------
 20499
(1 row)

-- Open the px_enable_insert_partition_table
set polar_px_enable_insert_partition_table='on';
--Insert into partition table select * from normal table
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
-- With Index
insert into px_parallel_dml_corr_t1_range_index select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t2_list select 'student',px_parallel_dml_corr_t0_select_table.id from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id LIMIT 1000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
select count(*) from px_parallel_dml_corr_t0_hash;
 count 
-------
 31000
(1 row)

select count(*) from px_parallel_dml_corr_t1_range;
 count 
-------
 16000
(1 row)

select count(*) from px_parallel_dml_corr_t2_list;
 count 
-------
 32002
(1 row)

--Insert into partition table select * from partition table
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t1_range where id < 2000;
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:60: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t0_hash select * from px_pa...
                                                        ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t0_hash select 100000,pvalue from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:64: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t1_range select * from px_p...
                                                         ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t1_range select 100000,pvalue from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
insert into px_parallel_dml_corr_t2_list select 'student',px_parallel_dml_corr_t0_hash.id from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t1_range where id < 2000;
select count(*) from px_parallel_dml_corr_t0_hash;
 count 
-------
 33000
(1 row)

select count(*) from px_parallel_dml_corr_t1_range;
 count 
-------
 18000
(1 row)

select count(*) from px_parallel_dml_corr_t2_list;
 count 
-------
 38002
(1 row)

-- Close the px_enable_insert_partition_table
set polar_px_enable_insert_partition_table='off';
--Insert into partition table select * from normal table
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
-- With Index
insert into px_parallel_dml_corr_t1_range_index select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t2_list select 'student',px_parallel_dml_corr_t0_select_table.id from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
select count(*) from px_parallel_dml_corr_t0_hash;
 count 
-------
 34000
(1 row)

select count(*) from px_parallel_dml_corr_t1_range;
 count 
-------
 19000
(1 row)

select count(*) from px_parallel_dml_corr_t2_list;
 count 
-------
 40002
(1 row)

--Insert into partition table select * from partition table
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t1_range where id < 2000;
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:92: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t0_hash select * from px_pa...
                                                        ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t0_hash select 100000,pvalue from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:96: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t1_range select * from px_p...
                                                         ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t1_range select 100000,pvalue from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
insert into px_parallel_dml_corr_t2_list select * from 'student',px_parallel_dml_corr_t0_hash.id where id > 28000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:99: ERROR:  syntax error at or near "'student'"
LINE 1: ...t into px_parallel_dml_corr_t2_list select * from 'student',...
                                                             ^
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t1_range where id < 2000;
select count(*) from px_parallel_dml_corr_t0_hash;
 count 
-------
 37000
(1 row)

select count(*) from px_parallel_dml_corr_t1_range;
 count 
-------
 21000
(1 row)

select count(*) from px_parallel_dml_corr_t2_list;
 count 
-------
 45002
(1 row)

------------------------------------------------------------------------
--Insert into ... select from index
insert into px_parallel_dml_corr_t3 select * from px_parallel_dml_corr_t4 where c1 < 500;
insert into px_parallel_dml_corr_t3 select * from px_parallel_dml_corr_t4 where c2 < 500;
select count(*) from px_parallel_dml_corr_t3;
 count 
-------
  1998
(1 row)

------------------------------------------------------------------------
-- Select Join
-- Innser join
insert into px_parallel_dml_corr_t1 select c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 LEFT OUTER JOIN px_parallel_dml_corr_t3 using(c1);
insert into px_parallel_dml_corr_t1 select c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 RIGHT OUTER JOIN px_parallel_dml_corr_t3 using(c1);
insert into px_parallel_dml_corr_t1 select c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 FULL OUTER JOIN px_parallel_dml_corr_t3 using(c1);
insert into px_parallel_dml_corr_t1 select px_parallel_dml_corr_t2.c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 CROSS JOIN px_parallel_dml_corr_t3 LIMIT 5000;
insert into px_parallel_dml_corr_t1 select c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 NATURAL JOIN px_parallel_dml_corr_t3;
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
 39767
(1 row)

------------------------------------------------------------------------
-- Group BY
insert into px_parallel_dml_corr_t1 select * from px_parallel_dml_corr_t2 group by c1,c2;
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
 39919
(1 row)

----------------------------------------------------------------------------
---- Insert into table with default num
insert into px_parallel_dml_corr_t8 select c1 from px_parallel_dml_corr_t9;
select * from px_parallel_dml_corr_t8 ORDER BY c1 ASC;
 c1 |  c2   | c3 |            c4            
----+-------+----+--------------------------
  1 | 99999 |    | Wed Jun 22 19:10:25 2016
  2 | 99999 |    | Wed Jun 22 19:10:25 2016
  3 | 99999 |    | Wed Jun 22 19:10:25 2016
  4 | 99999 |    | Wed Jun 22 19:10:25 2016
  5 | 99999 |    | Wed Jun 22 19:10:25 2016
  6 | 99999 |    | Wed Jun 22 19:10:25 2016
  7 | 99999 |    | Wed Jun 22 19:10:25 2016
  8 | 99999 |    | Wed Jun 22 19:10:25 2016
  9 | 99999 |    | Wed Jun 22 19:10:25 2016
 10 | 99999 |    | Wed Jun 22 19:10:25 2016
 11 | 99999 |    | Wed Jun 22 19:10:25 2016
 12 | 99999 |    | Wed Jun 22 19:10:25 2016
 13 | 99999 |    | Wed Jun 22 19:10:25 2016
 14 | 99999 |    | Wed Jun 22 19:10:25 2016
 15 | 99999 |    | Wed Jun 22 19:10:25 2016
 16 | 99999 |    | Wed Jun 22 19:10:25 2016
 17 | 99999 |    | Wed Jun 22 19:10:25 2016
 18 | 99999 |    | Wed Jun 22 19:10:25 2016
 19 | 99999 |    | Wed Jun 22 19:10:25 2016
 20 | 99999 |    | Wed Jun 22 19:10:25 2016
(20 rows)

-- Writer workers > Read workers
set polar_px_insert_dop_num = 10;
\i sql/polar-dev/px_parallel_dml_init_corr.sql
-- create normal table
drop table if exists px_parallel_dml_corr_t1 cascade;
CREATE TABLE px_parallel_dml_corr_t1 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t1 select generate_series(1,100),generate_series(1,100);
drop table if exists px_parallel_dml_corr_t2 cascade;
CREATE TABLE px_parallel_dml_corr_t2 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t2 select generate_series(1,100),generate_series(1,100);
drop table if exists px_parallel_dml_corr_t3 cascade;
CREATE TABLE px_parallel_dml_corr_t3 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t3 select generate_series(1,1000),generate_series(1,1000);
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   100
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   100
(1 row)

-- create partition table
drop table if exists px_parallel_dml_corr_t0_hash_insert cascade;
CREATE TABLE px_parallel_dml_corr_t0_hash_insert (id int, value int) PARTITION BY HASH(id);
drop table if exists px_parallel_dml_corr_t0_insert cascade;
CREATE TABLE px_parallel_dml_corr_t0_insert (id int, value int);
drop table if exists px_parallel_dml_corr_t0_select_table cascade;
CREATE TABLE px_parallel_dml_corr_t0_select_table (id int, value int);
insert into px_parallel_dml_corr_t0_select_table select generate_series(1,12000),generate_series(1,12000);
drop table if exists px_parallel_dml_corr_t0_select_list_table cascade;
CREATE TABLE px_parallel_dml_corr_t0_select_list_table (status character varying(30), value int);
-- PX Insert... Select from Partition Table
------------------------------------------------------------------------
-- Create partition table
drop table if exists px_parallel_dml_corr_t0_hash cascade;
CREATE TABLE px_parallel_dml_corr_t0_hash (id int, value int) PARTITION BY HASH(id);
CREATE TABLE px_parallel_dml_corr_t0_hash_p1 PARTITION OF px_parallel_dml_corr_t0_hash FOR VALUES WITH (modulus 3, remainder 0);
CREATE TABLE px_parallel_dml_corr_t0_hash_p2 PARTITION OF px_parallel_dml_corr_t0_hash FOR VALUES WITH (modulus 3, remainder 1);
CREATE TABLE px_parallel_dml_corr_t0_hash_p3 PARTITION OF px_parallel_dml_corr_t0_hash FOR VALUES WITH (modulus 3, remainder 2);
insert into px_parallel_dml_corr_t0_hash select generate_series(1,30000),generate_series(1,30000);
------------------------------------------------------------------------
--range partition
--Partition constraint: ((x IS NOT NULL) AND (x >= 10) AND (x < 20))
drop table if exists px_parallel_dml_corr_t1_range cascade;
CREATE TABLE px_parallel_dml_corr_t1_range(id int, value int) PARTITION BY RANGE(id);
CREATE TABLE px_parallel_dml_corr_t1_range_p1 PARTITION OF px_parallel_dml_corr_t1_range FOR VALUES FROM (1) TO (10000);
CREATE TABLE px_parallel_dml_corr_t1_range_p2 PARTITION OF px_parallel_dml_corr_t1_range FOR VALUES FROM (10000) TO (20000);
CREATE TABLE px_parallel_dml_corr_t1_range_p3 PARTITION OF px_parallel_dml_corr_t1_range DEFAULT;
insert into px_parallel_dml_corr_t1_range select generate_series(1,30000, 2);
--range partition with INDEX
drop table if exists px_parallel_dml_corr_t1_range_index cascade;
CREATE TABLE px_parallel_dml_corr_t1_range_index(id int, value int) PARTITION BY RANGE(id);
CREATE TABLE px_parallel_dml_corr_t1_range_p1_index PARTITION OF px_parallel_dml_corr_t1_range_index FOR VALUES FROM (1) TO (10000);
CREATE TABLE px_parallel_dml_corr_t1_range_p2_index PARTITION OF px_parallel_dml_corr_t1_range_index FOR VALUES FROM (10000) TO (20000);
CREATE TABLE px_parallel_dml_corr_t1_range_p3_index PARTITION OF px_parallel_dml_corr_t1_range_index DEFAULT;
insert into px_parallel_dml_corr_t1_range_index select generate_series(1,30000, 2);
CREATE INDEX px_parallel_dml_corr_t1_partition_index on px_parallel_dml_corr_t1_range_index(id);
------------------------------------------------------------------------
--list
--Partition constraint: ((b IS NOT NULL) AND (b = ANY (ARRAY[1, 3])))
drop table if exists px_parallel_dml_corr_t2_list cascade;
create table px_parallel_dml_corr_t2_list(job character varying(30), pvalue int) partition by list (job);
CREATE TABLE px_parallel_dml_corr_t2_list_p1 PARTITION OF px_parallel_dml_corr_t2_list FOR VALUES IN ('student');
CREATE TABLE px_parallel_dml_corr_t2_list_p2 PARTITION OF px_parallel_dml_corr_t2_list FOR VALUES IN ('teacher');
CREATE TABLE px_parallel_dml_corr_t2_list_p3 PARTITION OF px_parallel_dml_corr_t2_list DEFAULT;
insert into px_parallel_dml_corr_t2_list select 'student',generate_series(1,10000);
insert into px_parallel_dml_corr_t2_list select 'teacher',generate_series(10000,20000);
insert into px_parallel_dml_corr_t2_list select 'other',generate_series(20000,30000);
-- Index Test Init
drop table if exists px_parallel_dml_corr_t4 cascade;
CREATE TABLE px_parallel_dml_corr_t4 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t4 select generate_series(1,1000),generate_series(1,1000);
CREATE INDEX t_index_corr on px_parallel_dml_corr_t4(c1);
-- Constrain Test Init
drop table if exists px_parallel_dml_corr_t5 cascade;
CREATE TABLE px_parallel_dml_corr_t5 (c1 int, c2 int not NULL) ;
drop table if exists px_parallel_dml_corr_t6 cascade;
CREATE TABLE px_parallel_dml_corr_t6 (c1 int, c2 int) ;
---- Insert into table with default num
drop table if exists px_parallel_dml_corr_t8 cascade;
CREATE TABLE px_parallel_dml_corr_t8(
c1 int,
c2 int DEFAULT 99999,
c3 varchar DEFAULT NULL,
c4 timestamp default '2016-06-22 19:10:25-07'
);
drop table if exists px_parallel_dml_corr_t9 cascade;
CREATE TABLE px_parallel_dml_corr_t9 (c1 int, c2 int) ;
insert into px_parallel_dml_corr_t9 select generate_series(1,20),generate_series(1,20);
\i sql/polar-dev/px_parallel_dml_base_corr.sql
-- Insert
insert into px_parallel_dml_corr_t1 select generate_series(1,60),generate_series(1,60);
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   160
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   100
(1 row)

insert into px_parallel_dml_corr_t1 select c2, c1 from px_parallel_dml_corr_t1;
insert into px_parallel_dml_corr_t2 select c2, c1 from px_parallel_dml_corr_t1;
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   320
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   420
(1 row)

insert into px_parallel_dml_corr_t1 select c2, c1 from px_parallel_dml_corr_t2 where c1 = '1';
insert into px_parallel_dml_corr_t2 select c2, c1 from px_parallel_dml_corr_t1 where c1 = '1';
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
   325
(1 row)

select count(*) from px_parallel_dml_corr_t2;
 count 
-------
   429
(1 row)

-- Not Use PX Insert
insert into px_parallel_dml_corr_t1 VALUES(100,100);
insert into px_parallel_dml_corr_t2 VALUES(200,200);
insert into px_parallel_dml_corr_t1 select generate_series(101,150),generate_series(101,150);
insert into px_parallel_dml_corr_t2 select generate_series(101,150),generate_series(101,150);
insert into px_parallel_dml_corr_t1 select 1,2;
insert into px_parallel_dml_corr_t2 select 3,4;
insert into px_parallel_dml_corr_t1 select generate_series(201,250), c2 from px_parallel_dml_corr_t2;
insert into px_parallel_dml_corr_t1 select generate_series(301,350),generate_series(301,350) union select * from px_parallel_dml_corr_t3;
-- Use PX Insert
insert into px_parallel_dml_corr_t1 select * from px_parallel_dml_corr_t2;
--Insert into normal table select * from partition table
insert into px_parallel_dml_corr_t0_insert select px_parallel_dml_corr_t0_hash.id,px_parallel_dml_corr_t1_range.value from px_parallel_dml_corr_t0_hash,px_parallel_dml_corr_t1_range where px_parallel_dml_corr_t0_hash.id = px_parallel_dml_corr_t1_range.id and px_parallel_dml_corr_t1_range.id < 2000;
insert into px_parallel_dml_corr_t0_insert select * from px_parallel_dml_corr_t0_hash where id < 2000;
insert into px_parallel_dml_corr_t0_insert select px_parallel_dml_corr_t0_hash.id,px_parallel_dml_corr_t1_range.value from px_parallel_dml_corr_t0_hash,px_parallel_dml_corr_t1_range where px_parallel_dml_corr_t0_hash.id = px_parallel_dml_corr_t1_range.id and px_parallel_dml_corr_t1_range.id > 28000;
insert into px_parallel_dml_corr_t0_insert select px_parallel_dml_corr_t0_hash.id,px_parallel_dml_corr_t1_range.value from px_parallel_dml_corr_t0_hash,px_parallel_dml_corr_t1_range where px_parallel_dml_corr_t0_hash.id = px_parallel_dml_corr_t1_range.id and px_parallel_dml_corr_t1_range.id > 28000;
insert into px_parallel_dml_corr_t0_insert select * from  px_parallel_dml_corr_t1_range where id > 29000;
insert into px_parallel_dml_corr_t0_insert select * from px_parallel_dml_corr_t2_list where job='student';
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:37: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t0_insert select * from px_...
                                                          ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t0_insert select 100000,pvalue from px_parallel_dml_corr_t2_list where job='student';
insert into px_parallel_dml_corr_t0_insert select id, px_parallel_dml_corr_t2_list.pvalue from px_parallel_dml_corr_t2_list,px_parallel_dml_corr_t0_hash where px_parallel_dml_corr_t2_list.job='student' and px_parallel_dml_corr_t0_hash.id < 5000 LIMIT 5000;
select count(*)from px_parallel_dml_corr_t0_insert;
 count 
-------
 20499
(1 row)

-- Open the px_enable_insert_partition_table
set polar_px_enable_insert_partition_table='on';
--Insert into partition table select * from normal table
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
-- With Index
insert into px_parallel_dml_corr_t1_range_index select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t2_list select 'student',px_parallel_dml_corr_t0_select_table.id from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id LIMIT 1000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
select count(*) from px_parallel_dml_corr_t0_hash;
 count 
-------
 31000
(1 row)

select count(*) from px_parallel_dml_corr_t1_range;
 count 
-------
 16000
(1 row)

select count(*) from px_parallel_dml_corr_t2_list;
 count 
-------
 32002
(1 row)

--Insert into partition table select * from partition table
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t1_range where id < 2000;
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:60: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t0_hash select * from px_pa...
                                                        ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t0_hash select 100000,pvalue from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:64: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t1_range select * from px_p...
                                                         ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t1_range select 100000,pvalue from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
insert into px_parallel_dml_corr_t2_list select 'student',px_parallel_dml_corr_t0_hash.id from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t1_range where id < 2000;
select count(*) from px_parallel_dml_corr_t0_hash;
 count 
-------
 33000
(1 row)

select count(*) from px_parallel_dml_corr_t1_range;
 count 
-------
 18000
(1 row)

select count(*) from px_parallel_dml_corr_t2_list;
 count 
-------
 38002
(1 row)

-- Close the px_enable_insert_partition_table
set polar_px_enable_insert_partition_table='off';
--Insert into partition table select * from normal table
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
-- With Index
insert into px_parallel_dml_corr_t1_range_index select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t2_list select 'student',px_parallel_dml_corr_t0_select_table.id from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t0_select_table order by px_parallel_dml_corr_t0_select_table.id limit 1000;
select count(*) from px_parallel_dml_corr_t0_hash;
 count 
-------
 34000
(1 row)

select count(*) from px_parallel_dml_corr_t1_range;
 count 
-------
 19000
(1 row)

select count(*) from px_parallel_dml_corr_t2_list;
 count 
-------
 40002
(1 row)

--Insert into partition table select * from partition table
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t1_range where id < 2000;
insert into px_parallel_dml_corr_t0_hash select * from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:92: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t0_hash select * from px_pa...
                                                        ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t0_hash select 100000,pvalue from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t1_range select * from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:96: ERROR:  column "id" is of type integer but expression is of type character varying
LINE 1: insert into px_parallel_dml_corr_t1_range select * from px_p...
                                                         ^
HINT:  You will need to rewrite or cast the expression.
insert into px_parallel_dml_corr_t1_range select 100000,pvalue from px_parallel_dml_corr_t2_list where job='teachar' and pvalue < 12000;
insert into px_parallel_dml_corr_t2_list select * from 'student',px_parallel_dml_corr_t0_hash.id where id > 28000;
psql:sql/polar-dev/px_parallel_dml_base_corr.sql:99: ERROR:  syntax error at or near "'student'"
LINE 1: ...t into px_parallel_dml_corr_t2_list select * from 'student',...
                                                             ^
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t0_hash where id > 28000;
insert into px_parallel_dml_corr_t2_list select * from px_parallel_dml_corr_t1_range where id < 2000;
select count(*) from px_parallel_dml_corr_t0_hash;
 count 
-------
 37000
(1 row)

select count(*) from px_parallel_dml_corr_t1_range;
 count 
-------
 21000
(1 row)

select count(*) from px_parallel_dml_corr_t2_list;
 count 
-------
 45002
(1 row)

------------------------------------------------------------------------
--Insert into ... select from index
insert into px_parallel_dml_corr_t3 select * from px_parallel_dml_corr_t4 where c1 < 500;
insert into px_parallel_dml_corr_t3 select * from px_parallel_dml_corr_t4 where c2 < 500;
select count(*) from px_parallel_dml_corr_t3;
 count 
-------
  1998
(1 row)

------------------------------------------------------------------------
-- Select Join
-- Innser join
insert into px_parallel_dml_corr_t1 select c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 LEFT OUTER JOIN px_parallel_dml_corr_t3 using(c1);
insert into px_parallel_dml_corr_t1 select c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 RIGHT OUTER JOIN px_parallel_dml_corr_t3 using(c1);
insert into px_parallel_dml_corr_t1 select c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 FULL OUTER JOIN px_parallel_dml_corr_t3 using(c1);
insert into px_parallel_dml_corr_t1 select px_parallel_dml_corr_t2.c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 CROSS JOIN px_parallel_dml_corr_t3 LIMIT 5000;
insert into px_parallel_dml_corr_t1 select c1,px_parallel_dml_corr_t3.c2 from px_parallel_dml_corr_t2 NATURAL JOIN px_parallel_dml_corr_t3;
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
 39767
(1 row)

------------------------------------------------------------------------
-- Group BY
insert into px_parallel_dml_corr_t1 select * from px_parallel_dml_corr_t2 group by c1,c2;
select count(*) from px_parallel_dml_corr_t1;
 count 
-------
 39919
(1 row)

----------------------------------------------------------------------------
---- Insert into table with default num
insert into px_parallel_dml_corr_t8 select c1 from px_parallel_dml_corr_t9;
select * from px_parallel_dml_corr_t8 ORDER BY c1 ASC;
 c1 |  c2   | c3 |            c4            
----+-------+----+--------------------------
  1 | 99999 |    | Wed Jun 22 19:10:25 2016
  2 | 99999 |    | Wed Jun 22 19:10:25 2016
  3 | 99999 |    | Wed Jun 22 19:10:25 2016
  4 | 99999 |    | Wed Jun 22 19:10:25 2016
  5 | 99999 |    | Wed Jun 22 19:10:25 2016
  6 | 99999 |    | Wed Jun 22 19:10:25 2016
  7 | 99999 |    | Wed Jun 22 19:10:25 2016
  8 | 99999 |    | Wed Jun 22 19:10:25 2016
  9 | 99999 |    | Wed Jun 22 19:10:25 2016
 10 | 99999 |    | Wed Jun 22 19:10:25 2016
 11 | 99999 |    | Wed Jun 22 19:10:25 2016
 12 | 99999 |    | Wed Jun 22 19:10:25 2016
 13 | 99999 |    | Wed Jun 22 19:10:25 2016
 14 | 99999 |    | Wed Jun 22 19:10:25 2016
 15 | 99999 |    | Wed Jun 22 19:10:25 2016
 16 | 99999 |    | Wed Jun 22 19:10:25 2016
 17 | 99999 |    | Wed Jun 22 19:10:25 2016
 18 | 99999 |    | Wed Jun 22 19:10:25 2016
 19 | 99999 |    | Wed Jun 22 19:10:25 2016
 20 | 99999 |    | Wed Jun 22 19:10:25 2016
(20 rows)

set polar_px_enable_insert_from_tableless = 0;
