import{_ as u,c as d,a as s,b as a,e as k,w as t,d as e,r as o,o as g}from"./app-HZE5kvva.js";const h={},m={class:"table-of-contents"};function v(l,n){const c=o("Badge"),r=o("ArticleInfo"),p=o("router-link"),i=o("RouteLink");return g(),d("div",null,[n[8]||(n[8]=s("h1",{id:"pgvector",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#pgvector"},[s("span",null,"pgvector")])],-1)),a(c,{type:"tip",text:"V11 / v1.1.35-",vertical:"top"}),a(r,{frontmatter:l.$frontmatter},null,8,["frontmatter"]),s("nav",m,[s("ul",null,[s("li",null,[a(p,{to:"#背景"},{default:t(()=>n[0]||(n[0]=[e("背景")])),_:1})]),s("li",null,[a(p,{to:"#使用方法"},{default:t(()=>n[1]||(n[1]=[e("使用方法")])),_:1}),s("ul",null,[s("li",null,[a(p,{to:"#安装插件"},{default:t(()=>n[2]||(n[2]=[e("安装插件")])),_:1})]),s("li",null,[a(p,{to:"#向量操作"},{default:t(()=>n[3]||(n[3]=[e("向量操作")])),_:1})]),s("li",null,[a(p,{to:"#卸载插件"},{default:t(()=>n[4]||(n[4]=[e("卸载插件")])),_:1})])])]),s("li",null,[a(p,{to:"#注意事项"},{default:t(()=>n[5]||(n[5]=[e("注意事项")])),_:1})])])]),n[9]||(n[9]=k(`<h2 id="背景" tabindex="-1"><a class="header-anchor" href="#背景"><span>背景</span></a></h2><p><a href="https://github.com/pgvector/pgvector" target="_blank" rel="noopener noreferrer"><code>pgvector</code></a> 作为一款高效的向量数据库插件，基于 PostgreSQL 的扩展机制，利用 C 语言实现了多种向量数据类型和运算算法，同时还能够高效存储与查询以向量表示的 AI Embedding。</p><p><code>pgvector</code> 支持 IVFFlat 索引。IVFFlat 索引能够将向量空间分为若干个划分区域，每个区域都包含一些向量，并创建倒排索引，用于快速地查找与给定向量相似的向量。IVFFlat 是 IVFADC 索引的简化版本，适用于召回精度要求高，但对查询耗时要求不严格（100ms 级别）的场景。相比其他索引类型，IVFFlat 索引具有高召回率、高精度、算法和参数简单、空间占用小的优势。</p><p><code>pgvector</code> 插件算法的具体流程如下：</p><ol><li>高维空间中的点基于隐形的聚类属性，按照 K-Means 等聚类算法对向量进行聚类处理，使得每个类簇有一个中心点</li><li>检索向量时首先遍历计算所有类簇的中心点，找到与目标向量最近的 n 个类簇中心</li><li>遍历计算 n 个类簇中心所在聚类中的所有元素，经过全局排序得到距离最近的 k 个向量</li></ol><h2 id="使用方法" tabindex="-1"><a class="header-anchor" href="#使用方法"><span>使用方法</span></a></h2><p><code>pgvector</code> 可以顺序检索或索引检索高维向量，关于索引类型和更多参数介绍可以参考插件源代码的 <a href="https://github.com/pgvector/pgvector/blob/master/README.md" target="_blank" rel="noopener noreferrer">README</a>。</p><h3 id="安装插件" tabindex="-1"><a class="header-anchor" href="#安装插件"><span>安装插件</span></a></h3><div class="language-sql" data-highlighter="prismjs" data-ext="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> EXTENSION vector<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div><h3 id="向量操作" tabindex="-1"><a class="header-anchor" href="#向量操作"><span>向量操作</span></a></h3><p>执行如下命令，创建一个含有向量字段的表：</p><div class="language-sql" data-highlighter="prismjs" data-ext="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t <span class="token punctuation">(</span>val vector<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div><p>执行如下命令，可以插入向量数据：</p><div class="language-sql" data-highlighter="prismjs" data-ext="sql"><pre><code><span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;[0,0,0]&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&#39;[1,2,3]&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&#39;[1,1,1]&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div><p>创建 IVFFlat 类型的索引：</p><ol><li><code>val vector_ip_ops</code> 表示需要创建索引的列名为 <code>val</code>，并且使用向量操作符 <code>vector_ip_ops</code> 来计算向量之间的相似度。该操作符支持向量之间的点积、余弦相似度、欧几里得距离等计算方式</li><li><code>WITH (lists = 1)</code> 表示使用的划分区域数量为 1，这意味着所有向量都将被分配到同一个区域中。在实际应用中，划分区域数量需要根据数据规模和查询性能进行调整</li></ol><div class="language-sql" data-highlighter="prismjs" data-ext="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> <span class="token keyword">ON</span> t <span class="token keyword">USING</span> ivfflat <span class="token punctuation">(</span>val vector_ip_ops<span class="token punctuation">)</span> <span class="token keyword">WITH</span> <span class="token punctuation">(</span>lists <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div><p>计算近似向量：</p><div class="language-sql" data-highlighter="prismjs" data-ext="sql"><pre><code><span class="line"><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> val <span class="token operator">&lt;</span><span class="token comment">#&gt; &#39;[3,3,3]&#39;;</span></span>
<span class="line">   val</span>
<span class="line"><span class="token comment">---------</span></span>
<span class="line"> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span></span>
<span class="line"> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line"> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">(</span><span class="token number">4</span> <span class="token keyword">rows</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><h3 id="卸载插件" tabindex="-1"><a class="header-anchor" href="#卸载插件"><span>卸载插件</span></a></h3><div class="language-sql" data-highlighter="prismjs" data-ext="sql"><pre><code><span class="line"><span class="token keyword">DROP</span> EXTENSION vector<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div><h2 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项"><span>注意事项</span></a></h2>`,22)),s("ul",null,[s("li",null,[a(i,{to:"/zh/features/epq/"},{default:t(()=>n[6]||(n[6]=[e("ePQ")])),_:1}),n[7]||(n[7]=e(" 支持通过排序遍历高维向量，不支持通过索引查询向量类型"))])])])}const b=u(h,[["render",v]]),E=JSON.parse('{"path":"/zh/features/extensions/pgvector.html","title":"pgvector","lang":"zh-CN","frontmatter":{"author":"山现","date":"2023/12/25","minute":10},"headers":[{"level":2,"title":"背景","slug":"背景","link":"#背景","children":[]},{"level":2,"title":"使用方法","slug":"使用方法","link":"#使用方法","children":[{"level":3,"title":"安装插件","slug":"安装插件","link":"#安装插件","children":[]},{"level":3,"title":"向量操作","slug":"向量操作","link":"#向量操作","children":[]},{"level":3,"title":"卸载插件","slug":"卸载插件","link":"#卸载插件","children":[]}]},{"level":2,"title":"注意事项","slug":"注意事项","link":"#注意事项","children":[]}],"git":{"updatedTime":1760793941000,"contributors":[{"name":"aCoder2013","username":"aCoder2013","email":"7877752+aCoder2013@users.noreply.github.com","commits":1,"url":"https://github.com/aCoder2013"}],"changelog":[{"hash":"6fcfdc2993a4b32b3c1c8119b43c3545d6ab9654","time":1760793941000,"email":"7877752+aCoder2013@users.noreply.github.com","author":"acoder2014","message":"fix: typo in arch-overview.md (#608)"}]},"filePathRelative":"zh/features/extensions/pgvector.md"}');export{b as comp,E as data};
